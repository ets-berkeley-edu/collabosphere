/**
 * Copyright 2015 UC Berkeley (UCB) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://opensource.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var _ = require('lodash');
var config = require('config');
var randomstring = require('randomstring');
var util = require('util');

var RestAPI = require('col-rest');

/**
 * Get an anonymous REST client
 *
 * @return {RestClient}     callback.client             An anonymous app user REST client
 */
var getAnonymousClient = module.exports.getAnonymousClient = function() {
  var options = {
    'host': util.format('localhost:%s', config.get('app.port'))
  };
  return RestAPI.createClient(options);
};

/**
 * Generate a fake Canvas Course that can be used to launch a tool. All of the inputs
 * are optional and will be generated if omitted.
 *
 * @param  {Canvas}         canvas          The canvas instance in which the course lives
 * @param  {Number}         [id]            The id of the course in Canvas
 * @param  {String}         [label]         The label of the course in Canvas
 * @param  {String}         [title]         The title of the course in Canvas
 * @return {CanvasCourse}                   An object that contains the information about the course
 */
var generateCanvasCourse = module.exports.generateCanvasCourse = function(canvas, id, label, title) {
  return {
    'canvas': _.extend({}, canvas),
    'id': id || _.random(10000000),
    'label': label || randomstring.generate(10),
    'title': title || randomstring.generate(25)
  };
};

/**
 * Generate a fake Canvas User that can be used to launch a tool. All of the inputs
 * are optional and will be generated if omitted.

 * @param  {Canvas}         canvas          The canvas instance in which the user lives
 * @param  {Number}         [id]            The id of the user in Canvas
 * @param  {String}         [roles]         The role of the user in the course, defaults to `Student`
 * @param  {String}         [givenName]     The given name of the user
 * @param  {String}         [familyName]    The family name of the user
 * @param  {String}         [loginId]       The login id for the user
 * @param  {String}         [userImage]     The url that points to a profile picture for the user
 * @return {CanvasUser}                     An object that contains the information about the user
 */
var generateCanvasUser = module.exports.generateCanvasUser = function(canvas, id, roles, givenName, familyName, loginId, userImage) {
  givenName = givenName || randomstring.generate(10);
  familyName = familyName || randomstring.generate(15);
  return {
    'canvas': _.extend({}, canvas),
    'id': id || _.random(10000000),
    'givenName': givenName,
    'familyName': familyName,
    'fullName': givenName + ' ' + familyName,
    'roles': roles || 'Student',
    'ext_roles': roles || 'Student',
    'loginId': loginId || (_.random(1000000) + '@berkeley.edu'),
    'guid': _.random(100000),
    'userImage': userImage || 'http://url.to/an/image.jpg'
  };
};
